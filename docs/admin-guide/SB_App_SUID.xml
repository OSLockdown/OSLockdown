<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book [
<!ENTITY % CommonEntities SYSTEM "../COMMON_ENTITIES.ent">
%CommonEntities;
]>
<appendix version="5.0" xml:id="app-suid" xml:lang="en" xmlns="http://docbook.org/ns/docbook"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <!--<?xml-stylesheet type="text/css" href="docbook.css"?>-->
  <title>Modifiable Files Controlling OS Lockdown</title>
  <indexterm>
    <primary>exclude-dirs</primary>
  </indexterm>
  <indexterm>
    <primary>inclusion-fstypes</primary>
  </indexterm>
  <indexterm>
    <primary>suid_whitelist</primary>
  </indexterm>
  <indexterm>
    <primary>sgid_whitelist</primary>
  </indexterm>
  <para>Four files in <filename>/var/lib/oslockdown/files</filename> impact how OS Lockdown processes files on your
    system. Each file is a text file with one entry per line. During execution, a master list of entries for each type
    of file is generated once per profile and for the duration of that action. </para>
  <para>The files, and the provisions for making changes to these files at run-time, are as follows: </para>
  <informaltable frame="all">
    <tgroup cols="2">
      <colspec align="left" colwidth="0.30*"/>
      <colspec align="left" colwidth="1.10*"/>
      <thead>
        <row>
          <entry>File</entry>
          <entry>Description</entry>
        </row>
      </thead>
      <tbody>
        <row>
          <entry><filename>exclude-dirs</filename></entry>
          <entry>This file contains a list (one entry per line) of directories (including children of those directories)
            that should be ignored by OS Lockdown. It is not intended to ignore a specific file, only directories. Each
            entry should be an absolute path.</entry>
        </row>
        <row>
          <entry><filename>inclusion-fstypes</filename></entry>
          <entry>This file contains a list (one entry per line) of filesystem types (<filename>fstypes</filename>) that
            should be examined. Any filesystem that has a <filename>fstype</filename> not in this list is ignored. The
            entries are filesystem types such as <filename>ext2</filename>, <filename>bitfs</filename>,
              <filename>ext4</filename>, etc.</entry>
        </row>
        <row>
          <entry><filename>suid_whitelist</filename></entry>
          <entry>This file contains a list (one entry per line) of absolute pathnames of executables that are allowed to
            have the SUID bit set. This list was generated by examining the vendor-supplied ISOs. The files are specific
            for the distribution of the operating system, not the version. In other words, on a Red Hat Enterprise Linux
            platform, the <filename>suid_whitelist</filename> file contains all of the executables with the SUID bit set
            for Red Hat Enterprise Linux 4, 5, and 6. In the future, these files may become much more specific for the
            individual releases. The <filename>suid_whitelist</filename> and <filename>sgid_whitelist</filename> lists
            are used when making changes to the permissions on individual files. For example, the
              <command>/usr/bin/passwd</command> command requires the SUID bit in order for users to change their own
            password. By having this command in the <filename>suid_whitelist</filename> file, OS Lockdown knows that
            this bit should not be removed. Each entry should be an absolute path.</entry>
        </row>
        <row>
          <entry><filename>sgid_whitelist</filename></entry>
          <entry>This file contains a list (one entry per line) of absolute pathnames of executables that are allowed to
            have the SGID bit set. This list was generated by examining the vendor-supplied ISOs.</entry>
        </row>
      </tbody>
    </tgroup>
  </informaltable>
  <para>Until OS Lockdown v4.0.9, only these four files were used in creating the exclusion list. When OS Lockdown was
    updated, any end-user changes to these file were lost, and had to be reapplied.</para>
  <para>OS Lockdown v4.0.9 introduced four additional files to preserve any custom updates. At installation time, any
    changes that were made to the system-provided files were preserved in these additional files. The new files share
    the same base name as the original files, and contain the suffix <filename>.custom</filename>. They share the same
    format and are considered extra information to be read when the exclusion list is generated. The
      <filename>.custom</filename> files are client-specific.</para>
  <para>There are two circumstances where a <filename>.custom</filename> file can be created:</para>
  <orderedlist numeration="arabic">
    <listitem>
      <para>When executing an install/update, if there are differences between the previous version and the newly
        installed version, these differences are added to a <filename>.custom</filename> file (this file is created if
        needed).</para>
    </listitem>
    <listitem>
      <para>If after installing v4.0.9 or higher and a <filename>.custom</filename> file was not created for any of the
        four original files, you must create the <filename>.custom</filename> equivalent and make the changes there to
        alter one of the original files. The ownership of the new file should be root with permissions no greater than
        440.</para>
    </listitem>
  </orderedlist>
  <para>In OS Lockdown v4.1.0, there are four new modules that apply profile-specific changes, one module for each of
    the four files. Each of these modules starts with &ldquo;(PROFILE CUSTOMIZATION)&rdquo;:</para>
  <indexterm>
    <primary>(PROFILE CUSTOMIZATION) inclusion-fstype additions</primary>
  </indexterm>
  <indexterm>
    <primary>(PROFILE CUSTOMIZATION) exclude-dirs additions</primary>
  </indexterm>
  <indexterm>
    <primary>(PROFILE CUSTOMIZATION) sgid_whitelist additions</primary>
  </indexterm>
  <indexterm>
    <primary>(PROFILE CUSTOMIZATION) suid_whitelist additions</primary>
  </indexterm>
  <itemizedlist>
    <listitem>
      <para>&ldquo;(PROFILE CUSTOMIZATION) inclusion-fstype additions&rdquo;</para>
    </listitem>
    <listitem>
      <para>&ldquo;(PROFILE CUSTOMIZATION) exclude-dirs additions&rdquo;</para>
    </listitem>
    <listitem>
      <para>&ldquo;(PROFILE CUSTOMIZATION) sgid_whitelist additions&rdquo;</para>
    </listitem>
    <listitem>
      <para>&ldquo;(PROFILE CUSTOMIZATION) suid_whitelist additions&rdquo;</para>
    </listitem>
  </itemizedlist>
  <para>The system-provided files, the profile-specific customizations, and the client-specific customizations allow for
    fine-grained control of which directories and files are examined and/or modified.</para>
  <para>During a Scan, Apply, or Undo operation, a working copy of each list is generated by starting with the
    system-provided file, applying any profile-specific customization, and then applying any client-specific
    customization. This allows for finely tuning exactly how these operations are to be performed. If the
    system-provided file does not exist or is unreadable, then the process stops. This is a safety feature to prevent
    you from rendering your system unusable. For example, if the <filename>suid_whitelist</filename> file is not
    readable (for any reason), then the SUID bit is removed from potentially <emphasis role="italic">all</emphasis>
    files.</para>
  <para>The format for customization is the same, regardless of whether the customization is at the profile level or the
    client level. Each customization should be on a line by itself. Any line starting with a '-' is considered a
    deletion, meaning that if the remainder of that line was already in the list, it is removed. Otherwise it is
    appended (if not already there).</para>
  <para>The following scenarios are described for an Enterprise deployment; however, the actions are the same for
    Standalone deployments.</para>
  <orderedlist numeration="arabic">
    <listitem>
      <para>Enterprise deployment attached to a SAN:</para>
      <para>This scenario consists of an Enterprise installation where everyone has mounted a large SAN. The SAN appears
        as a mount point using a fictional FakeSAN file system type. The SAN needs to be scanned, but having all of the
        attached clients attempt to scan the SAN at one time can cause serious degradation in performance. Instead, one
        client should be designated to process the SAN, and the remaining clients will ignore it. Add 'FakeSAN' to the
          <filename>/var/lib/oslockdown/files/inclusion-fstypes.custom</filename> file (creating it if needed) on the
        client that will process the SAN. When the client executes a profile from now on, any filesystem of type
        'FakeSAN' will be processed, while the remaining clients will not process the SAN.</para>
      <para/>
    </listitem>
    <listitem>
      <para>Deployment where all clients have third-party applications:</para>
      <para>This example consists of an installation with a third-party application requiring the SUID bit to be set.
        For this example, the &ldquo;(PROFILE CUSTOMIZATION) suid_whitelist additions&rdquo; module should be added to
        the profile. The absolute path to all SUID required executables are added as options to the module. The profile
        can be manually transferred between Standalone installations as well to provide a consistent lockdown.</para>
      <para/>
    </listitem>
    <listitem>
      <para>Enterprise deployment where users are not allowed to change passwords:</para>
      <para>This example is somewhat contrived, but consists of an installation where users are forbidden to change
        their own password. By default, the <command>/bin/password</command> command has the SUID bit set, but if the
        &ldquo;(PROFILE CUSTOMIZATION) suid_whitelist additions&rdquo; module is added with
          <filename>-/bin/su</filename> as the option, then when OS Lockdown is run, it will strip the SUID bit from
          <filename>/bin/su</filename>, as it will not be on the list of approved SUID executables.</para>
    </listitem>
  </orderedlist>
</appendix>
